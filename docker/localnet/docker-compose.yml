version: '3.8'

# CAUTION: Please ensure you edit values in ENV files before use
# Environment variables used in Docker Compose: config/compose-env/**
# Environment variables used in Docker Compose: config/compose-env/**

# USAGE: docker compose -f docker/localnet/docker-compose.yml --env-file docker/localnet/config/compose-env/[ENV-FILE].env up --detach

services:
  validator-0:
    image: ${BUILD_IMAGE}
    container_name: validator-0
    env_file:
      - config/container-env/validator-0.env
    ports:
      - target: 26656
        published: 26656    # Tendermint peer-to-peer (P2P) port
      - target: 26657
        published: 26657    # Tendermint RPC port
      - target: 1317
        published: 1317     # Cosmos REST API port
      - target: 9090
        published: 9090     # gRPC port
      - target: 9091
        published: 9091     # gRPC-Gateway port
      - target: 26660
        published: 26660    # Prometheus metrics port
    entrypoint: [ "node-start" ]
    healthcheck:
      test: curl -s http://localhost:26657/status | grep -c true
      interval: 10s
      timeout: 2s
      retries: 6
      start_period: 15s
    restart: "no"
    volumes:
      - type: volume
        source: validator-0-data
        target: /home/cheqd

  validator-1:
    image: ${BUILD_IMAGE}
    ports:
      - target: 26656
        published: 26756    # Tendermint peer-to-peer (P2P) port
      - target: 26657
        published: 26757    # Tendermint RPC port
      - target: 1317
        published: 1417     # Cosmos REST API port
      - target: 9090
        published: 9190     # gRPC port
      - target: 9091
        published: 9191     # gRPC-Gateway port
      - target: 26660
        published: 26760    # Prometheus metrics port
    entrypoint: [ "node-start" ]
    healthcheck:
      test: curl -s http://localhost:26757/status | grep -c true
      interval: 10s
      timeout: 2s
      retries: 6
      start_period: 15s
    volumes:
      - type: volume
        source: validator-1-data
        target: /home/cheqd
    env_file:
      - config/container-env/validator-1.env
    configs:
      - source: genesis
        target: /genesis
      - source: seeds
        target: /seeds
      - source: validator-1-node-key
        target: /node_key
      - source: validator-1-priv-val-key
        target: /priv_validator_key
      - source: validator-1-account-key
        target: /validator-account

  validator-2:
    image: ${BUILD_IMAGE}
    ports:
      - target: 26656
        published: 26856    # Tendermint peer-to-peer (P2P) port
      - target: 26657
        published: 26857    # Tendermint RPC port
      - target: 1317
        published: 1517     # Cosmos REST API port
      - target: 9090
        published: 9290     # gRPC port
      - target: 9091
        published: 9291     # gRPC-Gateway port
      - target: 26660
        published: 26860    # Prometheus metrics port
    entrypoint: [ "node-start" ]
    healthcheck:
      test: curl -s http://localhost:26857/status | grep -c true
      interval: 10s
      timeout: 2s
      retries: 6
      start_period: 15s
    volumes:
      - type: volume
        source: validator-2-data
        target: /home/cheqd
    env_file:
      - config/container-env/validator-2.env
    configs:
      - source: genesis
        target: /genesis
      - source: seeds
        target: /seeds
      - source: validator-2-node-key
        target: /node_key
      - source: validator-2-priv-val-key
        target: /priv_validator_key
      - source: validator-2-account-key
        target: /validator-account

  validator-3:
    image: ${BUILD_IMAGE}
    ports:
      - target: 26656
        published: 26956    # Tendermint peer-to-peer (P2P) port
      - target: 26657
        published: 26957    # Tendermint RPC port
      - target: 1317
        published: 1617     # Cosmos REST API port
      - target: 9090
        published: 9390     # gRPC port
      - target: 9091
        published: 9391     # gRPC-Gateway port
      - target: 26660
        published: 26960    # Prometheus metrics port
    entrypoint: [ "node-start" ]
    healthcheck:
      test: curl -s http://localhost:26957/status | grep -c true
      interval: 10s
      timeout: 2s
      retries: 6
      start_period: 15s
    volumes:
      - type: volume
        source: validator-3-data
        target: /home/cheqd
    env_file:
      - config/container-env/validator-3.env
    configs:
      - source: genesis
        target: /genesis
      - source: seeds
        target: /seeds
      - source: validator-3-node-key
        target: /node_key
      - source: validator-3-priv-val-key
        target: /priv_validator_key
      - source: validator-2-account-key
        target: /validator-account

  seed-0:
    image: ${BUILD_IMAGE}
    ports:
      - target: 26656
        published: 27056    # Tendermint peer-to-peer (P2P) port
      - target: 26657
        published: 27057    # Tendermint RPC port
      - target: 1317
        published: 1717     # Cosmos REST API port
      - target: 9090
        published: 9490     # gRPC port
      - target: 9091
        published: 9491     # gRPC-Gateway port
      - target: 26660
        published: 27060    # Prometheus metrics port
    entrypoint: [ "node-start" ]
    healthcheck:
      test: curl -s http://localhost:27057/status | grep -c true
      interval: 10s
      timeout: 2s
      retries: 6
      start_period: 15s
    volumes:
      - type: volume
        source: seed-0-data
        target: /home/cheqd
    env_file:
      - config/container-env/seed-0.env
    configs:
      - source: genesis
        target: /genesis
      - source: seeds
        target: /seeds
      - source: seed-0-node-key
        target: /node_key
      - source: seed-0-priv-val-key
        target: /priv_validator_key

  observer-0:
    image: ${BUILD_IMAGE}
    ports:
      - target: 26656
        published: 27156    # Tendermint peer-to-peer (P2P) port
      - target: 26657
        published: 27157    # Tendermint RPC port
      - target: 1317
        published: 1817     # Cosmos REST API port
      - target: 9090
        published: 9590     # gRPC port
      - target: 9091
        published: 9591     # gRPC-Gateway port
      - target: 26660
        published: 27160    # Prometheus metrics port
    volumes:
      - type: volume
        source: observer-0-data
        target: /home/cheqd
    entrypoint: [ "node-start" ]
    healthcheck:
      test: curl -s http://localhost:27157/status | grep -c true
      interval: 10s
      timeout: 2s
      retries: 6
      start_period: 15s
    env_file:
      - config/container-env/observer-0.env
    configs:
      - source: genesis
        target: /genesis
      - source: seeds
        target: /seeds
      - source: observer-0-node-key
        target: /node_key
      - source: observer-0-priv-val-key
        target: /priv_validator_key


configs:
  # Accounts to import
  import-accounts:
    file: config/import-accounts.json


volumes:
  validator-0-data:
  validator-1-data:
  validator-2-data:
  validator-3-data:
  seed-0-data:
  observer-0-data:
